<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Personales Pro V25 - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="dashboard-wrapper">
        
        <nav class="sidebar">
            <div class="sidebar-brand">
                <i class="fas fa-wallet fa-lg"></i>
                <span>Finanzas Pro</span>
            </div>

            <div class="nav flex-column mb-auto" role="tablist">
                <a class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard" role="tab">
                    <i class="fas fa-chart-pie"></i> Resumen
                </a>
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#cards" role="tab">
                    <i class="fas fa-credit-card"></i> Tarjetas
                </a>
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#loans" role="tab">
                    <i class="fas fa-hand-holding-usd"></i> Cobranza
                </a>
            </div>

            <div class="mt-4 pt-4 border-top border-white border-opacity-25 d-flex flex-column gap-2">
                
                <label class="btn btn-light w-100 fw-bold text-primary shadow-sm" style="cursor: pointer;">
                    <i class="fas fa-file-excel me-2"></i>Importar Excel
                    <input type="file" id="excelInput" hidden accept=".xlsx, .xls">
                </label>

                <button class="btn btn-sm btn-success w-100 fw-bold shadow-sm mt-2" onclick="downloadSmartTemplate()">
                    <i class="fas fa-file-excel me-2"></i>Descargar Formato de Llenado
                </button>

                <div class="row g-2 mt-1">
                    <div class="col-6">
                        <button class="btn btn-sm sidebar-footer-btn w-100 py-2 rounded-3" onclick="togglePrivacy()" title="Ocultar Montos">
                            <center><i class="fas fa-eye" id="privacy-icon"></i></center>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-sm sidebar-footer-btn w-100 py-2 rounded-3" onclick="openHistoryModal()" title="Historial">
                            <center><i class="fas fa-history"></i></center>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-sm sidebar-footer-btn w-100 py-2 rounded-3" onclick="downloadBackup()" title="Descargar Backup">
                            <center><i class="fas fa-download"></i></center>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-sm sidebar-footer-btn w-100 py-2 rounded-3" onclick="openRestoreModal()" title="Subir Backup">
                            <center><i class="fas fa-upload"></i></center>
                        </button>
                    </div>
                </div>
                <div class="text-center mt-3 opacity-50 small">Versi贸n 0.25</div>
            </div>
        </nav>

        <main class="main-content">
            <div class="container-fluid p-0">
                
                <div class="tab-content">
                    
                    <div class="tab-pane fade show active" id="dashboard">
                        
                        <div class="row g-4 mb-4">
                            <div class="col-md-3">
                                <div class="kpi-card kpi-danger">
                                    <i class="fas fa-credit-card kpi-icon-bg text-danger"></i>
                                    <div class="kpi-label">Deuda Total Tarjetas</div>
                                    <div class="money-display text-danger" id="kpi-debt">$0.00</div>
                                    <small class="text-muted" style="font-size: 0.75rem;">Monto a liquidar</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card kpi-success">
                                    <i class="fas fa-check-circle kpi-icon-bg text-success"></i>
                                    <div class="kpi-label">Cr茅dito Disponible</div>
                                    <div class="money-display text-success" id="kpi-available">$0.00</div>
                                    <small class="text-muted" style="font-size: 0.75rem;">Capacidad de compra</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card kpi-warning">
                                    <i class="fas fa-hand-holding-usd kpi-icon-bg text-warning"></i>
                                    <div class="kpi-label">Cuentas por Cobrar</div>
                                    <div class="money-display text-warning" id="kpi-loans">$0.00</div>
                                    <small class="text-muted" style="font-size: 0.75rem;">Dinero pendiente</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card kpi-primary">
                                    <i class="fas fa-wallet kpi-icon-bg text-primary"></i>
                                    <div class="kpi-label">Liquidez Total</div>
                                    <div class="money-display text-primary" id="kpi-assets">$0.00</div>
                                    <small class="text-muted" style="font-size: 0.75rem;">Efectivo + Bancos</small>
                                </div>
                            </div>
                        </div>


                        <div class="row g-4">
                            <div class="col-12">
                                <div class="card card-custom p-4 h-100 border-0">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h5 class="fw-bold text-dark mb-0">
                                            <i class="fas fa-chart-pie me-2 text-primary"></i>Distribuci贸n de Deuda
                                        </h5>
                                        <span class="badge bg-light text-dark border">Vista Actual</span>
                                    </div>
                                    <div class="chart-container-wrapper" style="height: 300px; position: relative;">
                                        <canvas id="mainChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4 mb-5">
                            <div class="col-12">
                                <div class="card card-custom border-0 shadow-sm overflow-hidden">
                                    <div class="card-body p-0">
                                        <div class="row g-0">
                                            
                                            <div class="col-md-4 p-4 bg-light border-end">
                                                <h6 class="fw-bold text-primary mb-1"><i class="fas fa-history me-2"></i>Proyecci贸n de Pagos</h6>
                                                <small class="text-muted d-block mb-4">Desliza para ver tus pagos futuros</small>
                                                
                                                <div class="text-center py-3">
                                                    <h2 class="fw-bold text-dark mb-0" id="proj-month-label">---</h2>
                                                    <small class="text-success fw-bold" id="proj-total-label">$0.00</small>
                                                </div>

                                                <div class="mt-4 px-2">
                                                    <label class="small fw-bold text-muted mb-2 d-flex justify-content-between">
                                                        <span>Hoy</span>
                                                        <span id="proj-end-date">Fin de Deuda</span>
                                                    </label>
                                                    <input type="range" class="form-range" id="time-slider" min="0" max="0" value="0" step="1" oninput="renderProjectionStep(this.value)">
                                                </div>
                                                
                                                <div class="mt-4 text-center">
                                                    <small class="text-muted fst-italic" id="proj-freedom-msg">...</small>
                                                </div>
                                            </div>

                                            <div class="col-md-8 p-4">
                                                <h6 class="fw-bold text-muted small border-bottom pb-2 mb-3">DESGLOSE POR TARJETA</h6>
                                                
                                                <div id="proj-details-list" style="height: 220px; overflow-y: auto;">
                                                    <div class="text-center text-muted py-5 mt-3">
                                                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                                        <p>Calculando futuro...</p>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row g-4 mb-5">
    
                            <div class="col-lg-6">
                                <div class="card card-custom h-100 border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 d-flex justify-content-between align-items-center">
                                        <h6 class="fw-bold text-dark mb-0">
                                            <i class="fas fa-hand-holding-usd me-2 text-warning"></i>Cuentas por Cobrar
                                        </h6>
                                        <span class="badge bg-warning text-dark rounded-pill" id="widget-loans-count">0 Activos</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex align-items-end mb-3">
                                            <h2 class="fw-bold text-dark mb-0 me-2" id="widget-loans-total">$0.00</h2>
                                            <small class="text-muted mb-1">pendientes de recuperaci贸n</small>
                                        </div>
                                        
                                        <div id="widget-loans-list" style="max-height: 200px; overflow-y: auto;">
                                            </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="card card-custom h-100 border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 d-flex justify-content-between align-items-center">
                                        <h6 class="fw-bold text-dark mb-0">
                                            <i class="fas fa-chart-line me-2 text-success"></i>Ingresos del Mes
                                        </h6>
                                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill border border-success border-opacity-25" id="widget-income-month">...</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex align-items-end mb-3">
                                            <h2 class="fw-bold text-success mb-0 me-2" id="widget-income-total">$0.00</h2>
                                            <small class="text-muted mb-1">acumulado este mes</small>
                                        </div>

                                        <div id="widget-income-list" style="max-height: 200px; overflow-y: auto;">
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <div class="card card-custom h-100 border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 d-flex justify-content-between align-items-center">
                                        <h6 class="fw-bold text-dark mb-0">
                                            <i class="fas fa-university me-2 text-primary"></i>Distribuci贸n en Cuentas
                                        </h6>
                                        <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill border border-primary border-opacity-25">Total: <span id="chart-total-debit">$0.00</span></span>
                                    </div>
                                    <div class="card-body position-relative">
                                        <div class="chart-pie-wrapper" style="height: 250px; position: relative;">
                                            <canvas id="debitPieChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card card-custom h-100 border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 d-flex justify-content-between align-items-center">
                                        <h6 class="fw-bold text-dark mb-0">
                                            <i class="fas fa-coins me-2 text-success"></i>Distribuci贸n de Efectivo
                                        </h6>
                                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill border border-success border-opacity-25">Total: <span id="chart-total-assets">$0.00</span></span>
                                    </div>
                                    <div class="card-body position-relative">
                                        <div class="chart-pie-wrapper" style="height: 250px; position: relative;">
                                            <canvas id="assetPieChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="cards">
                        <div class="row g-3">
                            
                            <div class="col-md-4">
                                <div class="card card-custom p-4 h-100 border-0 shadow-sm">
                                    
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="bg-primary bg-opacity-10 p-2 rounded-circle me-3 text-primary">
                                                <i class="fas fa-sliders-h fa-lg"></i>
                                            </div>
                                            <div>
                                                <h6 class="fw-bold mb-0">Panel de Control</h6>
                                                <small class="text-muted">Gestiona tus tarjetas</small>
                                            </div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary rounded-circle" onclick="openCreditModal()" title="Nueva Tarjeta de Cr茅dito">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    
                                    <hr class="text-muted opacity-25 mb-4">
                                    
                                    <label class="fw-bold small mb-2 text-muted text-uppercase">Seleccionar Tarjeta</label>
                                    
                                    <select id="card-selector" style="display: none;"></select>
                                    
                                    <div class="custom-select-wrapper mb-4" id="custom-card-select">
                                        <div class="custom-select-trigger">
                                            <span id="custom-select-text">Cargando...</span>
                                            <div class="arrow"></div>
                                        </div>
                                        <div class="custom-options" id="custom-select-options"></div>
                                    </div>
                                    
                                    <button class="btn btn-gradient w-100 rounded-pill py-2 fw-bold mb-3 shadow-sm" onclick="openPurchaseModal()">
                                        <i class="fas fa-plus-circle me-2"></i>Registrar Compra
                                    </button>

                                    <button class="btn btn-outline-success w-100 rounded-pill py-2 fw-bold mb-3" onclick="openPayCardModal()">
                                        <i class="fas fa-money-bill-wave me-2"></i>Pagar Tarjeta
                                    </button>
                                    
                                    <button class="btn btn-link text-danger text-decoration-none btn-sm w-100 mt-2" onclick="deleteCurrentCreditCard()">
                                        <i class="fas fa-trash-alt me-2"></i>Cancelar/Eliminar Tarjeta
                                    </button>

                                    <div class="alert alert-light border-0 bg-light rounded-3 small text-muted d-flex align-items-start mt-auto pt-3">
                                        <i class="fas fa-info-circle me-2 mt-1 text-primary"></i>
                                        <div><strong>Nota:</strong> Las compras manuales se suman a las detectadas en tu Excel autom谩ticamente.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-8">
                                <div class="card-visual-container">
                                    
                                    <div class="credit-card-header" id="card-visual-bg">
                                        <div class="d-flex justify-content-between align-items-start position-relative" style="z-index: 2;">
                                            <div>
                                                <div class="card-chip"></div>
                                                <h5 class="mb-0 fw-bold" id="card-name" style="letter-spacing: 1px;">...</h5>
                                            </div>
                                            <i class="fab fa-cc-visa fa-2x opacity-50" id="card-visual-icon"></i>
                                        </div>
                                        
                                        <div class="mt-4 position-relative" style="z-index: 2;">
                                            <div class="row text-center">
                                                <div class="col-4 border-end border-white border-opacity-25">
                                                    <div class="card-label">Deuda Total</div>
                                                    <div class="card-money-small" style="font-size: 1.2rem;" id="card-used">$0.00</div>
                                                </div>
                                                <div class="col-4 border-end border-white border-opacity-25">
                                                    <div class="card-label text-warning fw-bold">Pago Mensual</div>
                                                    <div class="card-money-big" style="font-size: 1.5rem;" id="card-monthly">$0.00</div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="card-label">Disponible</div>
                                                    <div class="card-money-small" style="font-size: 1.2rem;" id="card-avail">$0.00</div>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-between align-items-end mt-3 px-2">
                                                <div class="text-start">
                                                    <div class="small opacity-50" style="font-size: 0.6rem; text-transform: uppercase;">Pr贸x. Corte</div>
                                                    <div class="fw-bold" id="card-date-cut" style="font-size: 0.9rem;">--/--</div>
                                                </div>

                                                <div class="text-center small opacity-50" id="card-limit" style="font-size: 0.75rem;">L铆mite: $0.00</div>

                                                <div class="text-end">
                                                    <div class="small opacity-50" style="font-size: 0.6rem; text-transform: uppercase;">L铆mite Pago</div>
                                                    <div class="fw-bold" id="card-date-pay" style="font-size: 0.9rem;">--/--</div>
                                                </div>
                                            </div>
                                            </div>

                                        <div class="mt-3 position-relative" style="z-index: 2;">
                                            <div class="d-flex justify-content-between small mb-1">
                                                <span class="opacity-75">Uso de l铆nea</span>
                                                <span class="fw-bold" id="card-percent-text">0%</span>
                                            </div>
                                            <div class="progress" style="height: 6px; background: rgba(255,255,255,0.2);">
                                                <div id="card-progress" class="progress-bar bg-white" role="progressbar" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 transactions-container">
                                        <div id="credit-balance-alert" class="alert alert-success border-0 bg-success bg-opacity-10 text-success d-flex align-items-center d-none mb-4">
                                            <i class="fas fa-check-circle fa-lg me-3"></i>
                                            <div>
                                                <div class="fw-bold">Saldo a Favor</div>
                                                <div class="small">Tienes <strong id="credit-balance-amount">$0.00</strong> extra pagados a esta tarjeta.</div>
                                            </div>
                                        </div>

                                        <h6 class="fw-bold text-muted mb-3 small text-uppercase">
                                            <i class="fas fa-list-ul me-2"></i>Movimientos Registrados
                                        </h6>
                                        
                                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                            <table class="table table-fancy w-100 mb-0 align-middle">
                                                <thead class="sticky-top">
                                                    <tr>
                                                        <th>Concepto</th>
                                                        <th class="text-center">Plazo</th>
                                                        <th class="text-end">Monto Orig.</th>
                                                        <th class="text-end">Por Pagar</th>
                                                        <th class="text-end"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="transactions-body"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="loans">
                        <div class="row g-4">
                            
                            <div class="col-lg-7 col-xl-8">
                                
                                <div class="card card-custom p-4 mb-4 border-0 shadow-sm">
                                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                                        <h5 class="text-danger fw-bold mb-0"><i class="fas fa-hand-holding-usd me-2"></i>Cuentas por Cobrar</h5>
                                        <button class="btn btn-sm btn-outline-danger rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#addLoanModal">+ Nuevo</button>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0">
                                            <thead class="text-muted small text-uppercase"><tr><th>Deudor</th><th class="text-end">Restante</th><th class="text-end">Acci贸n</th></tr></thead>
                                            <tbody id="loans-body"></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h5 class="text-primary fw-bold mb-3 px-1"><i class="fas fa-wallet me-2"></i>Mis Cuentas de D茅bito</h5>
                                    <div class="row g-3 justify-content-center" id="debit-grid">
                                        </div>
                                </div>

                                <div class="card card-custom p-4 border-0 shadow-sm">
                                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                                        <h5 class="text-success fw-bold mb-0"><i class="fas fa-money-bill-wave me-2"></i>Efectivo y Activos</h5>
                                        <div>
                                            <button class="btn btn-sm btn-outline-primary rounded-pill px-2 me-1" onclick="openDepositModal()" title="Depositar a Banco"><i class="fas fa-exchange-alt"></i></button>
                                            <button class="btn btn-sm btn-outline-success rounded-pill px-3" onclick="openAssetModal('Cash')">+ Agregar</button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0">
                                            <thead class="text-muted small text-uppercase"><tr><th>Concepto</th><th class="text-end">Monto</th><th class="text-end"></th></tr></thead>
                                            <tbody id="assets-body"></tbody>
                                        </table>
                                    </div>
                                    <div class="mt-3 p-3 bg-success bg-opacity-10 rounded-3 border border-success border-opacity-25 d-flex justify-content-between align-items-center">
                                        <span class="text-success fw-bold text-uppercase small">Total Disponible</span>
                                        <span class="fs-4 fw-bold text-success" id="total-assets-sum">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-5 col-xl-4">
                                <div class="card card-custom p-4 h-100 border-0 shadow-sm">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h5 class="text-primary fw-bold mb-0"><i class="fas fa-calendar-alt me-2"></i>Ingresos</h5>
                                        <div class="d-flex align-items-center gap-2 bg-light rounded-pill px-2 py-1 border">
                                            <button class="btn btn-sm btn-icon-nav" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                            <span class="badge bg-success" id="month-label" style="min-width: 100px;">Mes Actual</span>
                                            <button class="btn btn-sm btn-icon-nav" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                                        </div>
                                    </div>
                                    
                                    <div class="calendar-wrapper mb-4">
                                        <div class="calendar-header-row mb-2 d-flex justify-content-between text-muted small fw-bold text-center">
                                            <div style="width:14%">L</div><div style="width:14%">M</div><div style="width:14%">M</div><div style="width:14%">J</div><div style="width:14%">V</div><div style="width:14%">S</div><div class="text-success" style="width:14%">D</div>
                                        </div>
                                        <div id="calendar-days" class="calendar-grid"></div>
                                    </div>
                                    
                                    <h6 class="fw-bold border-bottom pb-2 mb-3 small text-muted">HISTORIAL DEL MES</h6>
                                    <div style="height: 250px; overflow-y: auto;">
                                        <table class="table table-sm table-borderless small mb-0 align-middle">
                                            <tbody id="income-list-body"></tbody>
                                        </table>
                                    </div>
                                    <div class="text-center mt-3 pt-3 border-top">
                                        <h2 class="text-success fw-bold mb-0" id="total-income-display">$0.00</h2>
                                        <small class="text-muted">Total Ingresos Visualizados</small>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div> </div>
        </main>
    </div>

    <div class="modal fade" id="addLoanModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold">Nuevo Deudor</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="text" id="nl-name" class="form-control mb-2" placeholder="Nombre">
                    <input type="number" id="nl-amount" class="form-control" placeholder="Monto ($)">
                </div>
                <div class="modal-footer border-top-0 pt-0">
                    <button type="button" class="btn btn-danger w-100 rounded-pill" onclick="addNewLoan()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="payModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 bg-success text-white">
                    <h6 class="modal-title fw-bold">Registrar Abono</h6><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="pay-label" class="small fw-bold mb-2 text-muted"></p>
                    <div class="input-group"><span class="input-group-text">$</span><input type="number" id="pay-amount" class="form-control" placeholder="0.00"></div>
                    <input type="hidden" id="pay-idx">
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-success w-100 rounded-pill" onclick="submitPay()">Confirmar Pago</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addAssetModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold text-success">Agregar Activo</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <label class="small text-muted mb-1">Tipo:</label>
                    <select id="asset-type-select" class="form-select mb-2" onchange="toggleCustomAssetInput()">
                        <option value="Billetes"> Billetes</option><option value="Monedas"> Monedas</option><option value="Beca"> Beca</option><option value="Otro">锔 Otro (Escribir...)</option>
                    </select>
                    <input type="text" id="asset-custom-name" class="form-control mb-2 d-none" placeholder="Nombre del activo...">
                    <label class="small text-muted mb-1">Monto:</label>
                    <div class="input-group"><span class="input-group-text">$</span><input type="number" id="asset-amount" class="form-control" placeholder="0.00"></div>
                </div>
                <div class="modal-footer border-top-0 pt-0"><button type="button" class="btn btn-success w-100 rounded-pill" onclick="saveNewAsset()">Guardar Dinero</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addDebitModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0">
                    <h6 class="modal-title fw-bold"><i class="fas fa-plus-circle me-2"></i>Nueva Cuenta</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="card-preview mb-4 text-white p-4 rounded-4 shadow-sm mx-auto position-relative overflow-hidden" 
                         id="new-card-preview" 
                         style="background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); width: 100%; aspect-ratio: 1.58; display: flex; flex-direction: column; justify-content: space-between;">
                        <div class="d-flex justify-content-between align-items-start position-relative" style="z-index: 2;">
                            <i class="fas fa-wifi opacity-50 fa-lg"></i>
                            <i class="fab fa-cc-visa fa-2x" id="preview-network-icon"></i>
                        </div>
                        <div class="position-relative opacity-50" style="z-index: 2; font-family: monospace; letter-spacing: 2px; font-size: 1.1rem;">
                            **** **** **** 1234
                        </div>
                        <div class="position-relative d-flex justify-content-between align-items-end" style="z-index: 2;">
                            <div><div class="small opacity-75" style="font-size: 0.6rem; text-transform: uppercase;">Banco</div><span class="fw-bold text-uppercase" id="preview-name" style="letter-spacing: 1px; font-size: 0.9rem;">BANCO</span></div>
                            <div class="text-end"><div class="small opacity-75" style="font-size: 0.6rem; text-transform: uppercase;">Saldo</div><h4 class="fw-bold mb-0" id="preview-balance">$0.00</h4></div>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-12"><label class="small fw-bold text-muted mb-1">Nombre del Banco</label><input type="text" id="new-debit-name" class="form-control fw-bold text-dark fs-5 py-2" placeholder="Ej. Banorte" oninput="updateCardPreview()"></div>
                        <div class="col-6"><label class="small fw-bold text-muted mb-1">Saldo Inicial</label><input type="number" id="new-debit-balance" class="form-control fw-bold text-success fs-5 py-2" placeholder="0.00" oninput="updateCardPreview()"></div>
                        <div class="col-6"><label class="small fw-bold text-muted mb-1">Red</label><select id="new-debit-network" class="form-select fw-bold text-dark fs-5 py-2" onchange="updateCardPreview()"><option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="amex">Amex</option></select></div>
                        <div class="col-12 mt-3"><label class="small fw-bold text-muted mb-2">Color de Tarjeta</label><div class="d-flex gap-2 justify-content-center flex-wrap">
                            <input type="radio" class="btn-check" name="card-color" id="c_blue" value="blue" checked onclick="updateCardPreview()"><label class="btn rounded-circle p-3" for="c_blue" style="background: linear-gradient(135deg, #00b4db, #0083b0); width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></label>
                            <input type="radio" class="btn-check" name="card-color" id="c_purple" value="purple" onclick="updateCardPreview()"><label class="btn rounded-circle p-3" for="c_purple" style="background: linear-gradient(135deg, #82269e, #a450c0); width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></label>
                            <input type="radio" class="btn-check" name="card-color" id="c_dark" value="dark" onclick="updateCardPreview()"><label class="btn rounded-circle p-3" for="c_dark" style="background: linear-gradient(135deg, #232526, #414345); width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></label>
                            <input type="radio" class="btn-check" name="card-color" id="c_teal" value="teal" onclick="updateCardPreview()"><label class="btn rounded-circle p-3" for="c_teal" style="background: linear-gradient(135deg, #11998e, #38ef7d); width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></label>
                            <input type="radio" class="btn-check" name="card-color" id="c_orange" value="orange" onclick="updateCardPreview()"><label class="btn rounded-circle p-3" for="c_orange" style="background: linear-gradient(135deg, #f12711, #f5af19); width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></label>
                        </div></div>
                    </div>
                    <div class="error-msg-inline text-center mt-3" style="display:none;"></div>
                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-4">
                    <button type="button" class="btn btn-dark w-100 rounded-pill py-2 fw-bold" onclick="saveNewDebit()"><i class="fas fa-check"></i> Crear Tarjeta</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="calendarModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0">
                    <div><h6 class="modal-title fw-bold" id="cal-modal-title">Registrar Ingreso</h6><small class="text-muted" id="cal-modal-subtitle">Selecciona el origen del dinero</small></div>
                    <div class="d-flex gap-2"><button class="btn btn-light rounded-circle text-secondary" onclick="openSourceManager()" title="Personalizar Fuentes"><i class="fas fa-cog"></i></button><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                </div>
                <div class="modal-body p-4">
                    <label class="small fw-bold text-muted mb-2">Fuente de Ingreso</label>
                    <div class="income-grid" id="income-options-container"></div>
                    <div class="row g-3">
                        <div class="col-6"><label class="small fw-bold text-muted mb-1">Monto ($)</label><input type="number" id="cal-modal-amount" class="form-control fw-bold fs-5 text-success py-2" placeholder="0.00"></div>
                        <div class="col-6"><label class="small fw-bold text-muted mb-1">Depositar en:</label><select id="cal-target-account" class="form-select fw-bold text-dark fs-5 py-2"></select></div>
                    </div>
                    <div class="error-msg-inline text-center mt-3" style="display:none;"></div>
                    <input type="hidden" id="cal-modal-date"><input type="hidden" id="cal-old-amount" value="0"><input type="hidden" id="cal-old-link" value="">
                </div>
                <div class="modal-footer border-top-0 pt-0 pb-4 px-4 d-flex justify-content-between">
                    <button type="button" class="btn btn-delete-fancy rounded-pill px-4 d-none" id="btn-delete-income" onclick="deleteCalendarIncome()"><i class="fas fa-trash-alt me-2"></i>Eliminar</button>
                    <button type="button" class="btn btn-success rounded-pill px-4 fw-bold shadow-sm ms-auto" onclick="saveCalendarIncome()"><i class="fas fa-save me-2"></i>Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="manageSourceModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold">Nueva Fuente</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4"><div class="income-option-label d-inline-flex px-4 py-3 shadow-sm" id="source-preview-box" style="border: 2px solid transparent;"><i class="fas fa-briefcase fa-lg mb-2" id="source-preview-icon"></i><span class="small fw-bold" id="source-preview-text">Nombre</span></div></div>
                    <label class="small fw-bold text-muted mb-1">Nombre</label><input type="text" id="new-source-name" class="form-control mb-3" placeholder="Ej. Cripto, Rentas..." oninput="updateSourcePreview()">
                    <label class="small fw-bold text-muted mb-1">Icono</label>
                    <div class="d-flex gap-2 justify-content-between mb-3 overflow-auto pb-2">
                        <button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-briefcase')"><i class="fas fa-briefcase"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-store')"><i class="fas fa-store"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-laptop-code')"><i class="fas fa-laptop-code"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-gift')"><i class="fas fa-gift"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-chart-line')"><i class="fas fa-chart-line"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-coins')"><i class="fas fa-coins"></i></button><button class="btn btn-outline-light text-dark border" onclick="setSourceIcon('fa-home')"><i class="fas fa-home"></i></button>
                    </div>
                    <input type="hidden" id="new-source-icon" value="fa-briefcase">
                    <label class="small fw-bold text-muted mb-1">Color</label>
                    <div class="d-flex gap-1 justify-content-center flex-wrap">
                        <input type="radio" class="btn-check" name="source-color" id="sc_green" value="#11998e" checked onclick="updateSourcePreview()"><label class="btn rounded-circle" for="sc_green" style="background: #11998e; width: 30px; height: 30px;"></label>
                        <input type="radio" class="btn-check" name="source-color" id="sc_blue" value="#00b4db" onclick="updateSourcePreview()"><label class="btn rounded-circle" for="sc_blue" style="background: #00b4db; width: 30px; height: 30px;"></label>
                        <input type="radio" class="btn-check" name="source-color" id="sc_orange" value="#f12711" onclick="updateSourcePreview()"><label class="btn rounded-circle" for="sc_orange" style="background: #f12711; width: 30px; height: 30px;"></label>
                        <input type="radio" class="btn-check" name="source-color" id="sc_purple" value="#82269e" onclick="updateSourcePreview()"><label class="btn rounded-circle" for="sc_purple" style="background: #82269e; width: 30px; height: 30px;"></label>
                        <input type="radio" class="btn-check" name="source-color" id="sc_dark" value="#343a40" onclick="updateSourcePreview()"><label class="btn rounded-circle" for="sc_dark" style="background: #343a40; width: 30px; height: 30px;"></label>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-4"><button type="button" class="btn btn-dark w-100 rounded-pill" onclick="saveNewSource()">Crear Fuente</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold text-danger">Eliminar Registro</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body text-center">
                    <div class="mb-3"><i class="fas fa-exclamation-circle text-danger fa-3x"></i></div>
                    <p class="small text-muted mb-0">驴Est谩s seguro de eliminar este elemento? Esta acci贸n no se puede deshacer.</p>
                    <input type="hidden" id="del-type"><input type="hidden" id="del-idx">
                </div>
                <div class="modal-footer border-top-0 pt-0">
                    <div class="row w-100 g-2">
                        <div class="col-6"><button type="button" class="btn btn-light w-100 rounded-pill" data-bs-dismiss="modal">Cancelar</button></div>
                        <div class="col-6"><button type="button" class="btn btn-danger w-100 rounded-pill" onclick="confirmDelete()">Eliminar</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 text-white" id="edit-modal-header" style="background: #333;">
                    <div>
                        <h6 class="modal-title fw-bold mb-0"><i class="fas fa-cog me-2"></i>Gestionar Cuenta</h6>
                        <small class="opacity-75" style="font-size: 0.75rem;">Edici贸n y Opciones</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <label class="small text-muted fw-bold mb-1">Nombre</label>
                    <div class="input-group mb-3">
                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-signature text-muted"></i></span>
                        <input type="text" id="edit-name" class="form-control fw-bold border-start-0">
                    </div>

                    <div id="edit-color-block" class="mb-3 d-none">
                        <label class="small text-muted fw-bold mb-2">Apariencia de la Tarjeta</label>
                        <div class="d-flex flex-wrap gap-2">
                            <style>
                                .edit-color-radio { display: none; }
                                .edit-color-label { 
                                    width: 30px; height: 30px; border-radius: 50%; cursor: pointer; 
                                    border: 2px solid transparent; transition: transform 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                }
                                .edit-color-radio:checked + .edit-color-label { 
                                    transform: scale(1.2); border-color: #333; box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
                                }
                            </style>

                            <input type="radio" name="edit-color" value="brand_nu" id="ec_nu" class="edit-color-radio">
                            <label for="ec_nu" class="edit-color-label" title="Nu" style="background: linear-gradient(135deg, #82269e, #5d1875);"></label>

                            <input type="radio" name="edit-color" value="brand_bbva" id="ec_bbva" class="edit-color-radio">
                            <label for="ec_bbva" class="edit-color-label" title="BBVA" style="background: linear-gradient(135deg, #004481, #1a2d52);"></label>

                            <input type="radio" name="edit-color" value="brand_mercado" id="ec_mp" class="edit-color-radio">
                            <label for="ec_mp" class="edit-color-label" title="MercadoPago" style="background: linear-gradient(135deg, #009ee3, #007eb5);"></label>
                            
                            <input type="radio" name="edit-color" value="brand_santander" id="ec_sant" class="edit-color-radio">
                            <label for="ec_sant" class="edit-color-label" title="Santander" style="background: linear-gradient(135deg, #ec0000, #b30000);"></label>

                            <input type="radio" name="edit-color" value="brand_cashi" id="ec_cashi" class="edit-color-radio">
                            <label for="ec_cashi" class="edit-color-label" title="Cashi" style="background: linear-gradient(135deg, #ff005e, #d6004f);"></label>

                            <input type="radio" name="edit-color" value="blue" id="ec_blue" class="edit-color-radio">
                            <label for="ec_blue" class="edit-color-label" title="Azul" style="background: linear-gradient(135deg, #00b4db, #0083b0);"></label>

                            <input type="radio" name="edit-color" value="dark" id="ec_dark" class="edit-color-radio">
                            <label for="ec_dark" class="edit-color-label" title="Negro" style="background: linear-gradient(135deg, #232526, #414345);"></label>
                            
                            <input type="radio" name="edit-color" value="green" id="ec_green" class="edit-color-radio">
                            <label for="ec_green" class="edit-color-label" title="Verde" style="background: linear-gradient(135deg, #0f9b0f, #005c00);"></label>

                            <input type="radio" name="edit-color" value="gold" id="ec_gold" class="edit-color-radio">
                            <label for="ec_gold" class="edit-color-label" title="Dorado" style="background: linear-gradient(135deg, #f7971e, #ffd200);"></label>
                        </div>
                    </div>

                    <label class="small text-muted fw-bold mb-1">Saldo Total</label>
                    <div class="input-group mb-4">
                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-dollar-sign text-muted"></i></span>
                        <input type="number" id="edit-amount" class="form-control fw-bold fs-5 border-start-0">
                    </div>

                    <div id="quick-actions-block">
                        <h6 class="border-bottom pb-2 mb-3 small fw-bold text-primary">OPERACIONES RPIDAS</h6>
                        <div class="row g-2 mb-3">
                            <div class="col-6"><button class="btn btn-outline-danger w-100 btn-sm" onclick="showQuickInput('-')"><i class="fas fa-minus me-1"></i>Retirar</button></div>
                            <div class="col-6"><button class="btn btn-outline-success w-100 btn-sm" onclick="showQuickInput('+')"><i class="fas fa-plus me-1"></i>Ingresar</button></div>
                        </div>
                        <div id="quick-input-container" class="bg-light p-3 rounded-3 border d-none fade-in-down mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="small fw-bold mb-0 text-dark">Detalles del movimiento:</label>
                                <button type="button" class="btn-close small" onclick="hideQuickInput()" aria-label="Cerrar"></button>
                            </div>
                            <select id="quick-context-select" class="form-select form-select-sm mb-2 shadow-sm fw-bold text-secondary"></select>
                            <div class="input-group">
                                <input type="number" id="quick-amount-val" class="form-control fw-bold" placeholder="0.00">
                                <button class="btn btn-dark fw-bold" id="quick-apply-btn" onclick="applyQuickInput()">Aplicar</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-auto pt-2 border-top">
                        <button class="btn btn-link text-danger text-decoration-none btn-sm w-100 mt-2" onclick="deleteFromEdit()">
                            <i class="fas fa-trash-alt me-2"></i>Eliminar esta cuenta permanentemente
                        </button>
                    </div>

                    <input type="hidden" id="edit-type">
                    <input type="hidden" id="edit-idx">
                </div>

                <div class="modal-footer border-top-0 pt-0 pb-4 px-4">
                    <button type="button" class="btn btn-dark w-100 rounded-pill fw-bold shadow-sm py-2" onclick="saveEdit()">
                        <i class="fas fa-check-circle me-2"></i>Guardar Todo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addPurchaseModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-fancy shadow-lg">
                <div class="modal-header-fancy"><div class="d-flex justify-content-between align-items-center position-relative" style="z-index: 2;"><div><h5 class="modal-title fw-bold"><i class="fas fa-shopping-bag me-2"></i>Nueva Compra</h5><p class="mb-0 small opacity-75">Agregando a: <strong id="purchase-card-name" class="text-warning">...</strong></p></div><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div></div>
                <div class="modal-body p-4">
                    <div class="mb-3"><label class="small fw-bold text-muted mb-1">Categor铆a</label><div class="input-group"><span class="input-group-text"><i class="fas fa-layer-group"></i></span><select id="new-purch-cat" class="form-select input-modern" style="border-left: none;"><option value="General"> General / Varios</option><option value="Comida"> Comida / Restaurantes</option><option value="Super"> Supermercado</option><option value="Transporte"> Transporte / Gasolina</option><option value="Servicios"> Servicios (Luz, Agua, Internet)</option><option value="Salud"> Salud / Farmacia</option><option value="Entretenimiento"> Entretenimiento / Streaming</option><option value="Ropa"> Ropa / Calzado</option><option value="Educacion"> Educaci贸n</option></select></div></div>
                    <div class="mb-3"><label class="small fw-bold text-muted mb-1">Concepto / Tienda</label><div class="input-group"><span class="input-group-text"><i class="fas fa-tag"></i></span><input type="text" id="new-purch-desc" class="form-control input-modern" placeholder="Ej. Amazon, Walmart..."></div></div>
                    <div class="row g-3"><div class="col-6"><label class="small fw-bold text-muted mb-1">Monto Total</label><div class="input-group"><span class="input-group-text"><i class="fas fa-dollar-sign"></i></span><input type="number" id="new-purch-amount" class="form-control input-modern" placeholder="0.00"></div></div><div class="col-6"><label class="small fw-bold text-muted mb-1">Plazos</label><div class="input-group"><span class="input-group-text"><i class="fas fa-calendar-alt"></i></span><select id="new-purch-months" class="form-select input-modern" style="border-left: none;"><option value="1">Contado</option><option value="3">3 MSI</option><option value="6">6 MSI</option><option value="9">9 MSI</option><option value="12">12 MSI</option><option value="18">18 MSI</option><option value="24">24 MSI</option></select></div></div></div>
                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-4"><button type="button" class="btn btn-gradient w-100 rounded-pill py-2 fw-bold" onclick="savePurchase()"><i class="fas fa-check-circle me-2"></i>Confirmar Gasto</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteTransModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold text-danger">Borrar Movimiento</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body text-center"><div class="mb-3"><i class="fas fa-trash-alt text-danger fa-3x"></i></div><p class="small text-muted mb-0">驴Eliminar esta compra de la tarjeta?</p><p class="small fw-bold text-dark mt-1" id="del-trans-name">...</p><input type="hidden" id="del-trans-index"></div>
                <div class="modal-footer border-top-0 pt-0"><div class="row w-100 g-2"><div class="col-6"><button type="button" class="btn btn-light w-100 rounded-pill" data-bs-dismiss="modal">Cancelar</button></div><div class="col-6"><button type="button" class="btn btn-danger w-100 rounded-pill" onclick="confirmDeleteTransaction()">Borrar</button></div></div></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="restoreBackupModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 bg-warning bg-opacity-10"><h6 class="modal-title fw-bold text-dark"><i class="fas fa-history me-2 text-warning"></i>Restaurar Datos</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-4 text-center"><div class="mb-4"><i class="fas fa-file-import fa-3x text-muted mb-3"></i><p class="text-muted small">Selecciona tu archivo <strong>.json</strong> de respaldo.<br><span class="text-danger fw-bold">锔 Advertencia:</span> Esto reemplazar谩 toda la informaci贸n actual.</p></div><div class="input-group mb-3"><input type="file" class="form-control" id="backup-file-input" accept=".json"></div></div>
                <div class="modal-footer border-top-0 pt-0 justify-content-center pb-4"><button type="button" class="btn btn-dark rounded-pill px-4" onclick="processRestoreFile()"><i class="fas fa-check-circle me-2"></i>Cargar y Actualizar</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="payCardModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 bg-success bg-opacity-10"><h6 class="modal-title fw-bold text-success"><i class="fas fa-money-bill-wave me-2"></i>Pagar Tarjeta</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-4">
                    <div class="alert alert-light border small text-muted mb-3">Pagando a: <strong id="pay-card-target-name" class="text-dark">...</strong></div>
                    <label class="small fw-bold text-muted mb-1">Origen de Fondos (D茅bito)</label><select id="pay-source-account" class="form-select mb-1 shadow-sm" onchange="calcRemainingBalance()"></select>
                    <div class="text-end mb-3"><small class="text-muted" style="font-size: 0.75rem;">Saldo final estimado: <span id="pay-remaining-balance" class="fw-bold text-success">---</span></small></div>
                    <label class="small fw-bold text-muted mb-1">Monto a Pagar</label><div class="input-group mb-2"><span class="input-group-text bg-white text-success fw-bold">$</span><input type="number" id="pay-card-amount" class="form-control fw-bold" placeholder="0.00" oninput="calcRemainingBalance()"><button class="btn btn-outline-secondary" type="button" onclick="fillFullDebt()">Liquidar</button></div>
                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-4"><button type="button" class="btn btn-success w-100 rounded-pill fw-bold shadow-sm" onclick="processCardPayment()">Confirmar Pago</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="depositModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 bg-primary bg-opacity-10"><h6 class="modal-title fw-bold text-primary"><i class="fas fa-university me-2"></i>Depositar a Cuenta</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-4">
                    <div class="alert alert-light border small text-muted mb-3">Mueve dinero de tus activos f铆sicos (Efectivo) a tus cuentas digitales.</div>
                    <label class="small fw-bold text-muted mb-1">Origen (驴Qu茅 depositas?)</label><select id="dep-source-asset" class="form-select mb-3 shadow-sm"></select>
                    <label class="small fw-bold text-muted mb-1">Destino (驴A qu茅 banco va?)</label><select id="dep-target-account" class="form-select mb-3 shadow-sm"></select>
                    <label class="small fw-bold text-muted mb-1">Monto a Depositar</label><div class="input-group mb-3"><span class="input-group-text bg-white text-primary fw-bold">$</span><input type="number" id="dep-amount" class="form-control fw-bold" placeholder="0.00"></div>
                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-4"><button type="button" class="btn btn-primary w-100 rounded-pill fw-bold shadow-sm" onclick="processDeposit()">Confirmar Dep贸sito</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalConfirmarDeposito" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-bottom-0 pb-0"><h6 class="modal-title fw-bold text-dark">Confirmaci贸n</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body text-center"><div class="mb-3"><i class="fas fa-exchange-alt text-primary fa-3x"></i></div><p id="texto-confirmar-deposito" class="text-muted small fw-bold mb-0">...</p></div>
                <div class="modal-footer border-top-0 pt-0 justify-content-center pb-4"><div class="row w-100 g-2"><div class="col-6"><button type="button" class="btn btn-light w-100 rounded-pill" data-bs-dismiss="modal">Cancelar</button></div><div class="col-6"><button type="button" class="btn btn-primary w-100 rounded-pill" onclick="ejecutarDepositoReal()">S铆, Depositar</button></div></div></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="historyModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0"><h6 class="modal-title fw-bold"><i class="fas fa-history me-2"></i>ltimos Movimientos</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-0"><div id="history-list-body" class="p-3"></div></div>
                <div class="modal-footer border-top-0 pt-0"><button type="button" class="btn btn-light w-100 rounded-pill btn-sm" data-bs-dismiss="modal">Cerrar</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addCreditModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0">
                    <h6 class="modal-title fw-bold">Nueva Tarjeta de Cr茅dito</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    
                    <div class="text-center mb-3">
                        <div class="d-inline-block rounded-3 p-3 text-white shadow-sm" id="new-credit-preview-box" style="width: 100%; max-width: 280px; height: 160px; background: #333; display: flex; flex-direction: column; justify-content: space-between;">
                            <div class="d-flex justify-content-between"><i class="fas fa-wifi opacity-50"></i><i class="fab fa-cc-visa fa-lg" id="prev-cc-icon"></i></div>
                            <div class="text-start"><div class="small opacity-50">BANCO</div><div class="fw-bold" id="prev-cc-name">NOMBRE</div></div>
                            <div class="text-end"><div class="small opacity-50">LMITE</div><div class="fw-bold" id="prev-cc-limit">$0.00</div></div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-12">
                            <label class="small text-muted fw-bold">Nombre</label>
                            <input type="text" id="new-cc-name" class="form-control" placeholder="Ej. Nu, BBVA Oro" oninput="updateCCPreview()">
                        </div>
                        
                        <div class="col-6">
                            <label class="small text-muted fw-bold">L铆mite ($)</label>
                            <input type="number" id="new-cc-limit" class="form-control" placeholder="0.00" oninput="updateCCPreview()">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted fw-bold">Red</label>
                            <select id="new-cc-network" class="form-select" onchange="updateCCPreview()">
                                <option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="amex">Amex</option>
                            </select>
                        </div>

                        <div class="col-6">
                            <label class="small text-muted fw-bold"> D铆a de Corte</label>
                            <input type="number" id="new-cc-cut-day" class="form-control" placeholder="Ej. 14" min="1" max="31">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted fw-bold"> D铆as de Pago</label>
                            <input type="number" id="new-cc-pay-days" class="form-control" placeholder="Ej. 20" value="20">
                        </div>
                        <div class="col-12 mt-3">
                            <label class="small text-muted fw-bold mb-2">Color</label>
                            <div class="d-flex gap-2 justify-content-center flex-wrap">
                                <input type="radio" class="btn-check" name="cc-color" id="ccc_dark" value="dark" checked onclick="updateCCPreview()"><label class="btn rounded-circle" for="ccc_dark" style="background: #333; width: 30px; height: 30px;"></label>
                                <input type="radio" class="btn-check" name="cc-color" id="ccc_blue" value="blue" onclick="updateCCPreview()"><label class="btn rounded-circle" for="ccc_blue" style="background: #00b4db; width: 30px; height: 30px;"></label>
                                <input type="radio" class="btn-check" name="cc-color" id="ccc_purple" value="purple" onclick="updateCCPreview()"><label class="btn rounded-circle" for="ccc_purple" style="background: #82269e; width: 30px; height: 30px;"></label>
                                <input type="radio" class="btn-check" name="cc-color" id="ccc_gold" value="gold" onclick="updateCCPreview()"><label class="btn rounded-circle" for="ccc_gold" style="background: #f7971e; width: 30px; height: 30px;"></label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0 px-4 pb-4">
                    <button class="btn btn-dark w-100 rounded-pill" onclick="createCreditCard()">Crear Tarjeta</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteCardConfirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0">
                    <h6 class="modal-title fw-bold text-danger">Eliminar Tarjeta</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <div class="bg-danger bg-opacity-10 p-3 rounded-circle d-inline-flex text-danger">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                    </div>
                    <p class="mb-1 text-dark fw-bold" id="del-confirm-card-name">...</p>
                    <p class="small text-muted mb-0">Esta acci贸n es permanente y no se puede deshacer. 驴Deseas continuar?</p>
                    
                    <input type="hidden" id="del-confirm-idx">
                </div>
                <div class="modal-footer border-top-0 pt-0 px-4 pb-4">
                    <div class="row w-100 g-2">
                        <div class="col-6">
                            <button type="button" class="btn btn-light w-100 rounded-pill fw-bold" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-danger w-100 rounded-pill fw-bold" onclick="executeCardDelete()">
                                S铆, Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cantDeleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow">
                <div class="modal-body text-center p-4">
                    <div class="mb-3 text-warning">
                        <i class="fas fa-hand-paper fa-3x"></i>
                    </div>
                    <h6 class="fw-bold mb-2">No se puede eliminar</h6>
                    <p class="small text-muted mb-4" id="cant-delete-msg">...</p>
                    <button type="button" class="btn btn-dark w-100 rounded-pill" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="configCardModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Configuraci贸n de Tarjeta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-3">Ajusta las fechas de corte o cambia la apariencia de la tarjeta.</p>
                    
                    <input type="hidden" id="cfg-card-index">

                    <div class="row g-2 mb-4">
                        <div class="col-6">
                            <label class="form-label small fw-bold text-muted"> D铆a Corte</label>
                            <input type="number" id="cfg-cut-day" class="form-control fw-bold text-center" placeholder="Ej. 14">
                        </div>
                        <div class="col-6">
                            <label class="form-label small fw-bold text-muted"> D铆as Pago</label>
                            <input type="number" id="cfg-pay-days" class="form-control fw-bold text-center" placeholder="Ej. 20">
                        </div>
                        <div class="col-12"><div class="form-text small text-center">D铆a de cierre y d铆as l铆mite para pagar.</div></div>
                    </div>

                    <hr class="opacity-10 my-3">

                    <label class="form-label small fw-bold text-muted mb-2 d-block text-center"> Apariencia Manual</label>
                    
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3" id="cfg-color-container">
                        <style>
                            .color-radio { display: none; }
                            .color-label { 
                                width: 35px; height: 35px; border-radius: 50%; cursor: pointer; 
                                border: 2px solid transparent; transition: transform 0.2s;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            }
                            .color-radio:checked + .color-label { 
                                transform: scale(1.2); border-color: #333; box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
                            }
                        </style>

                        <input type="radio" name="cfg-color" value="brand_nu" id="cc_nu" class="color-radio">
                        <label for="cc_nu" class="color-label" title="Nu (Morado)" style="background: linear-gradient(135deg, #82269e, #5d1875);"></label>

                        <input type="radio" name="cfg-color" value="brand_bbva" id="cc_bbva" class="color-radio">
                        <label for="cc_bbva" class="color-label" title="BBVA (Azul)" style="background: linear-gradient(135deg, #004481, #1a2d52);"></label>

                        <input type="radio" name="cfg-color" value="brand_mercado" id="cc_mp" class="color-radio">
                        <label for="cc_mp" class="color-label" title="MercadoPago" style="background: linear-gradient(135deg, #009ee3, #007eb5);"></label>

                        <input type="radio" name="cfg-color" value="brand_santander" id="cc_sant" class="color-radio">
                        <label for="cc_sant" class="color-label" title="Santander" style="background: linear-gradient(135deg, #ec0000, #b30000);"></label>

                        <input type="radio" name="cfg-color" value="brand_cashi" id="cc_cashi" class="color-radio">
                        <label for="cc_cashi" class="color-label" title="Cashi" style="background: linear-gradient(135deg, #ff005e, #d6004f);"></label>
                        
                        <input type="radio" name="cfg-color" value="brand_uala" id="cc_uala" class="color-radio">
                        <label for="cc_uala" class="color-label" title="Ual谩" style="background: linear-gradient(135deg, #ff5e5e, #e04545);"></label>

                        <input type="radio" name="cfg-color" value="brand_stori" id="cc_stori" class="color-radio">
                        <label for="cc_stori" class="color-label" title="Stori" style="background: linear-gradient(135deg, #00a5a3, #007a79);"></label>
                        
                        <div class="w-100"></div> <input type="radio" name="cfg-color" value="blue" id="cc_blue" class="color-radio">
                        <label for="cc_blue" class="color-label" title="Azul" style="background: linear-gradient(135deg, #00b4db, #0083b0);"></label>

                        <input type="radio" name="cfg-color" value="dark" id="cc_dark" class="color-radio">
                        <label for="cc_dark" class="color-label" title="Negro" style="background: linear-gradient(135deg, #232526, #414345);"></label>

                        <input type="radio" name="cfg-color" value="gold" id="cc_gold" class="color-radio">
                        <label for="cc_gold" class="color-label" title="Dorado" style="background: linear-gradient(135deg, #f7971e, #ffd200);"></label>
                        
                        <input type="radio" name="cfg-color" value="purple" id="cc_purple" class="color-radio">
                        <label for="cc_purple" class="color-label" title="Morado" style="background: linear-gradient(135deg, #82269e, #a450c0);"></label>

                        <input type="radio" name="cfg-color" value="green" id="cc_green" class="color-radio">
                        <label for="cc_green" class="color-label" title="Verde" style="background: linear-gradient(135deg, #0f9b0f, #005c00);"></label>
                    </div>

                </div>
                <div class="modal-footer border-0 pt-0 pb-4 px-3">
                    <button type="button" class="btn btn-primary w-100 rounded-pill fw-bold shadow-sm" onclick="saveCardConfig()">
                        <i class="fas fa-save me-2"></i>Aplicar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="projectionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 bg-dark text-white">
                    <div>
                        <h6 class="modal-title fw-bold"><i class="fas fa-calendar-alt me-2"></i>Proyecci贸n Detallada</h6>
                        <small class="opacity-75">Desglose de pagos futuros por tarjeta</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0 align-middle" style="font-size: 0.9rem;">
                            <thead class="bg-light sticky-top">
                                <tr class="text-center text-muted text-uppercase small">
                                    <th class="py-3 bg-white" style="width: 15%;">Mes</th>
                                    <th class="py-3 bg-white text-start ps-3">Desglose por Tarjeta</th>
                                    <th class="py-3 bg-white" style="width: 20%;">Total Mes</th>
                                </tr>
                            </thead>
                            <tbody id="projection-body">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer border-top-0 justify-content-center py-3 bg-light">
                    <small class="text-muted text-center" id="freedom-date-msg">...</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="loanPaidModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-body text-center p-4">
                    <div class="mb-3 text-success">
                        <i class="fas fa-check-circle fa-4x"></i>
                    </div>
                    <h5 class="fw-bold text-dark mb-2">隆Cobro Completado!</h5>
                    <p class="text-muted small mb-0">Has recuperado todo el dinero de <strong id="loan-paid-name" class="text-dark">...</strong>.</p>
                    <div class="alert alert-light border small mt-3 mb-0 text-muted">
                        <i class="fas fa-trash-alt me-1"></i> El registro se ha eliminado de la lista.
                    </div>
                    <button type="button" class="btn btn-success w-100 rounded-pill mt-3 fw-bold shadow-sm" data-bs-dismiss="modal">Excelente</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
        <div id="liveToast" class="toast align-items-center text-white bg-success border-0 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex"><div class="toast-body fw-bold" id="toast-msg"></div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="app.js"></script>
</body>
</html>